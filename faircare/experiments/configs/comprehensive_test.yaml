experiment_name: "comprehensive_test_faircare_fl"
save_dir: "results/comprehensive_test"
seeds: [13, 42, 123]

datasets:
  - name: "mimic"
    task: "mortality"
    sensitive_attr: "race"
    preprocessing: { normalize: true, impute: "median" }
    split: { train_val_test: [0.8, 0.1, 0.1] }
    heterogeneity: { dirichlet_alpha: 0.3, num_clients: 40 }

  - name: "eicu"
    task: "mortality"
    sensitive_attr: "sex"
    preprocessing: { normalize: true, impute: "median" }
    split: { train_val_test: [0.8, 0.1, 0.1] }
    heterogeneity: { dirichlet_alpha: 0.3, num_clients: 40 }

client_participation:
  scheme: "fraction"
  client_fraction: [0.3]
  min_clients_per_round: 10

trainer:
  rounds: [200]
  local_epochs: [2]
  batch_size: [128]
  optimizer: "adam"
  lr: [0.001]
  weight_decay: [0.0]
  scheduler: "cosine"
  grad_clip: 5.0
  early_stopping: { enabled: true, monitor: "val/worst_group_f1", mode: "max", patience_rounds: 20 }

evaluation:
  metrics: ["accuracy", "macro_f1", "worst_group_f1", "eo_gap", "fpr_gap", "sp_gap", "auroc"]
  on_server_val: true
  log_every: 1

algorithms: ["faircare_fl"]

algo_params:
  faircare_fl:
    version: "2.0.0"

    prox_mu: [0.0, 0.001]
    lambda_irm: [0.25, 0.5]
    lambda_adv: [0.1, 0.2]
    use_mixup: [true]
    use_cia: [true]

    server_momentum: [0.8]
    mgda: { normalize_grads: true, solver: "qp", step_size: 1.0 }
    pcgrad: { enabled: true }
    cagrad: { enabled: true, rho: [0.5, 0.7] }

    fairness_duals: { enabled: true, epsilon_eo: [0.02], epsilon_fpr: [0.02], lr: 0.1 }

    arl: { enabled: true, eta: [1.0, 2.0], width: 64, depth: 1 }

    selector: { enabled: true, mode: "lyapunov", tau: [0.02], kappa: [0.5] }

    distill: { enabled: true, temperature: [2.0], steps: [200], batch_size: [64] }

    dp: { enabled: false, clip: 1.0, noise_mult: 0.6 }

    delta_acc: [0.3]
    tau: [0.7]
    w_eo: [1.0]
    w_fpr: [1.0]
    w_sp: [0.5]
    weight_floor: 0.001
    weight_capx: 0.2

sweep: { strategy: "grid", max_runs: null }

logging:
  backend: "stdout"
  log_interval_rounds: 1
  save_checkpoints: true
  checkpoint_best_on: "val/worst_group_f1"

defaults:
  dataset_name: "mimic"
  algorithm: "faircare_fl"
  rounds: 200
  local_epochs: 2
